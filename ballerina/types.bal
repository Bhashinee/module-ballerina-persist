// Copyright (c) 2022 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
//
// WSO2 Inc. licenses this file to you under the Apache License,
// Version 2.0 (the "License"); you may not use this file except
// in compliance with the License.
// You may obtain a copy of the License at
//
// http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.

public type FieldMetadata record {|
    string? columnName = ();
    typedesc 'type;
    boolean autoGenerated = false;
    RelationMetadata? relation = ();
|};

public type RelationMetadata record {|
    string entityName;
    string refTable;
    string refField;
|};

public type JoinMetadata record {|
    typedesc<record {}> entity;
    string fieldName;
    string refTable;
    string[] refFields;
    string[]? joinColumns = ();
    JoinType 'type = ONE;
|};

public enum JoinType {
    ONE,
    MANY
}

# Defines the attributes of an Entity
#
# + key - The primary key of the table
# + uniqueConstraints - The set of single or multiple columns of a table that uniquely identify a each row in the table.
# + tableName - The table name
public type EntityConfig record {|
    string[] key;
    string[][] uniqueConstraints?;
    string tableName?;
|};

# The annotation is used to represent attributes of an entity such as primary keys,
# unique indexes, and table name.
public annotation EntityConfig Entity on type;

# Defines the auto-increment field configuration.
#
# + startValue - The starting value the field
# + increment - It is a positive integer, which is used to generate
#               the unique number in the field when the new row is entered
public type AutoIncrementConfig record {|
    int startValue = 1;
    int increment = 1;
|};

# The annotation is used to indicate the auto-increment field.
public annotation AutoIncrementConfig AutoIncrement on record field;

# Defines the configuration to indicate the associations of an entity.
#
# + keyColumns - The foreign key column
# + reference - The primary key of the other table
# + onDelete - The action which will be taken when the referenced value in the parent table is deleted
# + onUpdate - The action which will be taken when the referenced value in the parent table is updated
public type RelationConfig record {|
    string[] keyColumns?;
    string[] reference?;
    ReferenceAction onDelete?;
    ReferenceAction onUpdate?;
|};

# Defines actions that can be taken when deleting or updating the parent tableâ€™s values.
public enum ReferenceAction {
    RESTRICT,
    CASCADE,
    SET_NULL,
    NO_ACTION,
    SET_DEFAULT
}

# The annotation is used to indicate the associations of an entity.
public annotation RelationConfig Relation on field;
